{"version":3,"file":"registry-DvFP4JNY.cjs","sources":["../src/registry.ts"],"sourcesContent":["/**\r\n * Plugin registry for managing Crayon extensions\r\n */\r\nimport type { StylePlugin } from './plugins/base'\r\nimport type { AnsiCodes } from './ansi'\r\nimport type { StyledFunction } from './types'\r\n\r\n// Plugin storage\r\nexport let plugins: StylePlugin[] = []\r\n\r\n// Flag to track if plugins have changed\r\n\r\n// Storage for registered codes\r\nexport let registeredCodes: Record<string, AnsiCodes> = {}\r\n\r\n/** Register ANSI codes */\r\nexport function registerCodes(newCodes: Record<string, AnsiCodes>): void {\r\n  Object.assign(registeredCodes, newCodes)\r\n}\r\n\r\n/** Register a new plugin */\r\nexport function register(plugin: StylePlugin): void {\r\n  plugins.push(plugin)\r\n}\r\n\r\n/** Handle property access through registered plugins */\r\nexport function handleProperty(\r\n  target: StyledFunction,\r\n  prop: string,\r\n  codes: AnsiCodes[],\r\n  accumulatedText: string,\r\n  options?: {\r\n    createStyler?: Function,\r\n    ansiCodes?: Record<string, AnsiCodes>,\r\n    pluginRegistry?: any\r\n  }\r\n): StyledFunction | undefined {\r\n  for (const plugin of plugins) {\r\n    if (plugin.handleProperty) {\r\n      const result = plugin.handleProperty(target, prop, codes, accumulatedText, options)\r\n      if (result !== undefined) {\r\n        return result\r\n      }\r\n    }\r\n  }\r\n  return undefined\r\n}\r\n\r\n/** Filter out marker codes that don't produce visual output */\r\nexport function filterMarkerCodes(codes: AnsiCodes[]): AnsiCodes[] {\r\n  return codes.filter(code => {\r\n    // Ask each plugin if this is a marker code\r\n    for (const plugin of plugins) {\r\n      if (plugin.isMarkerCode && plugin.isMarkerCode(code)) {\r\n        return false // This is a marker, filter it out\r\n      }\r\n    }\r\n    return true // Not a marker, keep it\r\n  })\r\n}\r\n\r\n/** Let plugins process text with special behaviors (like auto-spacing) */\r\nexport function processText(codes: AnsiCodes[], text: string, accumulatedText: string): { styledText: string } | undefined {\r\n  // Let each plugin process the text if they have a processText method\r\n  for (const plugin of plugins) {\r\n    if (plugin.processText) {\r\n      const result = plugin.processText(codes, text, accumulatedText, filterMarkerCodes)\r\n      if (result !== undefined) {\r\n        return result\r\n      }\r\n    }\r\n  }\r\n  return undefined\r\n}"],"names":[],"mappings":";AAQO,IAAI,UAAyB,CAAA;AAK7B,IAAI,kBAA6C,CAAA;AAGjD,SAAS,cAAc,UAA2C;AACvE,SAAO,OAAO,iBAAiB,QAAQ;AACzC;AAGO,SAAS,SAAS,QAA2B;AAClD,UAAQ,KAAK,MAAM;AACrB;AAGO,SAAS,eACd,QACA,MACA,OACA,iBACA,SAK4B;AAC5B,aAAW,UAAU,SAAS;AAC5B,QAAI,OAAO,gBAAgB;AACzB,YAAM,SAAS,OAAO,eAAe,QAAQ,MAAM,OAAO,iBAAiB,OAAO;AAClF,UAAI,WAAW,QAAW;AACxB,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT;AAGO,SAAS,kBAAkB,OAAiC;AACjE,SAAO,MAAM,OAAO,CAAA,SAAQ;AAE1B,eAAW,UAAU,SAAS;AAC5B,UAAI,OAAO,gBAAgB,OAAO,aAAa,IAAI,GAAG;AACpD,eAAO;AAAA,MACT;AAAA,IACF;AACA,WAAO;AAAA,EACT,CAAC;AACH;AAGO,SAAS,YAAY,OAAoB,MAAc,iBAA6D;AAEzH,aAAW,UAAU,SAAS;AAC5B,QAAI,OAAO,aAAa;AACtB,YAAM,SAAS,OAAO,YAAY,OAAO,MAAM,iBAAiB,iBAAiB;AACjF,UAAI,WAAW,QAAW;AACxB,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT;;;;;;;;"}