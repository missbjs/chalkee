{"version":3,"file":"bg.mjs","sources":["../../src/plugins/bg.ts"],"sourcesContent":["import type { StylePlugin } from './base'\r\nimport type { StyledFunction } from '../types'\r\nimport type { AnsiCodes } from '../ansi'\r\nimport { registeredCodes, register } from '../registry'\r\n// Removed direct import of coreColorsPlugin to avoid circular dependencies\r\n\r\n// Background mode marker\r\nconst BG_MODE_MARKER = '\\x00BG\\x00'\r\n\r\nexport const bgPlugin: StylePlugin = {\r\n  name: 'bg',\r\n\r\n  handleProperty(_target: StyledFunction, prop: string, codes: AnsiCodes[], accumulatedText: string, options?: { createStyler?: Function, ansiCodes?: Record<string, AnsiCodes>, pluginRegistry?: any }) {\r\n    // Handle bg namespace - creates a persistent background-color mode\r\n    if (prop === 'bg') {\r\n      // Use the passed createStyler function to avoid circular dependencies\r\n      if (options?.createStyler) {\r\n        // Create a special marker for background-color mode\r\n        const bgModeCode = { open: BG_MODE_MARKER, close: '' }\r\n        return (options.createStyler as Function)([...codes, bgModeCode], accumulatedText)\r\n      }\r\n    }\r\n\r\n    // Check if we're in background-color mode\r\n    const bgMode = codes.some(code => code.open === BG_MODE_MARKER)\r\n\r\n    // Get core ANSI codes from the registry instead of directly importing coreColorsPlugin\r\n    const coreAnsiCodes = registeredCodes\r\n\r\n    // If in bg-mode and accessing a foreground color, convert to background color\r\n    if (bgMode && prop in coreAnsiCodes && !prop.startsWith('bg')) {\r\n      // Check if it's a foreground color (not a modifier like bold, italic, etc.)\r\n      const isForegroundColor = [\r\n        'black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white', 'gray', 'grey',\r\n        'blackBright', 'redBright', 'greenBright', 'yellowBright', 'blueBright', 'magentaBright', 'cyanBright', 'whiteBright'\r\n      ].includes(prop)\r\n\r\n      if (isForegroundColor) {\r\n        // Convert to background color: red -> bgRed, redBright -> bgRedBright\r\n        const bgStyleName = ('bg' + prop.charAt(0).toUpperCase() + prop.slice(1)) as keyof typeof coreAnsiCodes\r\n        if (bgStyleName in coreAnsiCodes && options?.createStyler) {\r\n          return (options.createStyler as Function)([...codes, coreAnsiCodes[bgStyleName]], accumulatedText)\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined\r\n  },\r\n\r\n  isMarkerCode(code: AnsiCodes) {\r\n    // Identify our bg-mode marker code\r\n    return code.open === BG_MODE_MARKER\r\n  }\r\n}\r\n\r\n// Self-register the plugin when imported\r\nregister(bgPlugin)\r\n\r\n// Add BG_MODE_CODE_MARKER as a property of the plugin so other plugins can access it\r\nObject.assign(bgPlugin, { BG_MODE_CODE_MARKER: BG_MODE_MARKER })\r\n\r\n// Augment the StyledFunction interface with bg mode property\r\ndeclare module '../types' {\r\n  interface StyledFunction {\r\n    // Nested namespace for background colors\r\n    bg: {\r\n      black: StyledFunction\r\n      red: StyledFunction\r\n      green: StyledFunction\r\n      yellow: StyledFunction\r\n      blue: StyledFunction\r\n      magenta: StyledFunction\r\n      cyan: StyledFunction\r\n      white: StyledFunction\r\n      blackBright: StyledFunction\r\n      redBright: StyledFunction\r\n      greenBright: StyledFunction\r\n      yellowBright: StyledFunction\r\n      blueBright: StyledFunction\r\n      magentaBright: StyledFunction\r\n      cyanBright: StyledFunction\r\n      whiteBright: StyledFunction\r\n\r\n    }\r\n  }\r\n}"],"names":[],"mappings":";AAOA,MAAM,iBAAiB;AAEhB,MAAM,WAAwB;AAAA,EACnC,MAAM;AAAA,EAEN,eAAe,SAAyB,MAAc,OAAoB,iBAAyB,SAAoG;AAErM,QAAI,SAAS,MAAM;AAEjB,UAAI,mCAAS,cAAc;AAEzB,cAAM,aAAa,EAAE,MAAM,gBAAgB,OAAO,GAAA;AAClD,eAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,UAAU,GAAG,eAAe;AAAA,MACnF;AAAA,IACF;AAGA,UAAM,SAAS,MAAM,KAAK,CAAA,SAAQ,KAAK,SAAS,cAAc;AAG9D,UAAM,gBAAgB;AAGtB,QAAI,UAAU,QAAQ,iBAAiB,CAAC,KAAK,WAAW,IAAI,GAAG;AAE7D,YAAM,oBAAoB;AAAA,QACxB;AAAA,QAAS;AAAA,QAAO;AAAA,QAAS;AAAA,QAAU;AAAA,QAAQ;AAAA,QAAW;AAAA,QAAQ;AAAA,QAAS;AAAA,QAAQ;AAAA,QAC/E;AAAA,QAAe;AAAA,QAAa;AAAA,QAAe;AAAA,QAAgB;AAAA,QAAc;AAAA,QAAiB;AAAA,QAAc;AAAA,MAAA,EACxG,SAAS,IAAI;AAEf,UAAI,mBAAmB;AAErB,cAAM,cAAe,OAAO,KAAK,OAAO,CAAC,EAAE,gBAAgB,KAAK,MAAM,CAAC;AACvE,YAAI,eAAe,kBAAiB,mCAAS,eAAc;AACzD,iBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,WAAW,CAAC,GAAG,eAAe;AAAA,QACnG;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,MAAiB;AAE5B,WAAO,KAAK,SAAS;AAAA,EACvB;AACF;AAGA,SAAS,QAAQ;AAGjB,OAAO,OAAO,UAAU,EAAE,qBAAqB,gBAAgB;"}