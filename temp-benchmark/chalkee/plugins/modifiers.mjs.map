{"version":3,"file":"modifiers.mjs","sources":["../../src/plugins/modifiers.ts"],"sourcesContent":["/**\r\n * Modifiers plugin\r\n * Provides ANSI modifier codes (bold, italic, underline, etc.) with proper TypeScript augmentation\r\n */\r\nimport type { StylePlugin } from './base'\r\nimport type { AnsiCodes } from '../ansi'\r\nimport { Styler, createStyler } from '../styler'\r\nimport { register, registerCodes, plugins, createStylerProperty } from '../registry'\r\n\r\n// Handle reset operation - clear special mode markers and add reset code\r\nfunction handleReset(codes: AnsiCodes[], resetCode: AnsiCodes): AnsiCodes[] {\r\n    // Quick exit if no plugins have isMarkerCode method\r\n    let hasIsMarkerCode = false\r\n    for (let i = 0; i < plugins.length; i++) {\r\n        if (plugins[i].isMarkerCode) {\r\n            hasIsMarkerCode = true\r\n            break\r\n        }\r\n    }\r\n\r\n    if (!hasIsMarkerCode) {\r\n        // Add the reset code directly\r\n        return [...codes, resetCode]\r\n    }\r\n\r\n    // Filter out mode markers by asking each plugin\r\n    const codesWithoutModes: AnsiCodes[] = []\r\n    for (let i = 0; i < codes.length; i++) {\r\n        const code = codes[i]\r\n        let isMarker = false\r\n        // Ask each plugin if this is a marker code\r\n        for (let j = 0; j < plugins.length; j++) {\r\n            const plugin = plugins[j]\r\n            if (plugin.isMarkerCode && plugin.isMarkerCode(code)) {\r\n                isMarker = true\r\n                break\r\n            }\r\n        }\r\n        if (!isMarker) {\r\n            codesWithoutModes.push(code)\r\n        }\r\n    }\r\n    // Add the reset code\r\n    return [...codesWithoutModes, resetCode]\r\n}\r\n\r\n// Modifier ANSI codes - defined at module level\r\nconst modifierCodes = {\r\n    // Modifiers\r\n    reset: { open: '\\x1b[0m', close: '\\x1b[0m' },\r\n    bold: { open: '\\x1b[1m', close: '\\x1b[22m' },\r\n    dim: { open: '\\x1b[2m', close: '\\x1b[22m' },\r\n    italic: { open: '\\x1b[3m', close: '\\x1b[23m' },\r\n    underline: { open: '\\x1b[4m', close: '\\x1b[24m' },\r\n    inverse: { open: '\\x1b[7m', close: '\\x1b[27m' },\r\n    hidden: { open: '\\x1b[8m', close: '\\x1b[28m' },\r\n    strikethrough: { open: '\\x1b[9m', close: '\\x1b[29m' },\r\n}\r\n\r\n// Register modifier codes when module is imported\r\nregisterCodes(modifierCodes)\r\n\r\n// Create a mapping of properties to their corresponding codes for better performance\r\nconst propertyCodeMap: Record<string, AnsiCodes | undefined> = {\r\n    // Standard modifiers\r\n    'bold': modifierCodes.bold,\r\n    'dim': modifierCodes.dim,\r\n    'italic': modifierCodes.italic,\r\n    'underline': modifierCodes.underline,\r\n    'inverse': modifierCodes.inverse,\r\n    'hidden': modifierCodes.hidden,\r\n    'strikethrough': modifierCodes.strikethrough,\r\n    'reset': modifierCodes.reset,\r\n\r\n    // Shorthand aliases\r\n    'b': modifierCodes.bold,\r\n    'd': modifierCodes.dim,\r\n    'i': modifierCodes.italic,\r\n    'u': modifierCodes.underline,\r\n    's': modifierCodes.strikethrough,\r\n    'r': modifierCodes.reset\r\n}\r\n\r\n// Define modifier properties directly on the Styler prototype\r\nObject.defineProperties(Styler.prototype, {\r\n    // Modifiers\r\n    reset: createStylerProperty(modifierCodes.reset, { createStyler }),\r\n    bold: createStylerProperty(modifierCodes.bold, { createStyler }),\r\n    dim: createStylerProperty(modifierCodes.dim, { createStyler }),\r\n    italic: createStylerProperty(modifierCodes.italic, { createStyler }),\r\n    underline: createStylerProperty(modifierCodes.underline, { createStyler }),\r\n    inverse: createStylerProperty(modifierCodes.inverse, { createStyler }),\r\n    hidden: createStylerProperty(modifierCodes.hidden, { createStyler }),\r\n    strikethrough: createStylerProperty(modifierCodes.strikethrough, { createStyler }),\r\n\r\n    // Shorthand aliases\r\n    r: createStylerProperty(modifierCodes.reset, { createStyler }),\r\n    b: createStylerProperty(modifierCodes.bold, { createStyler }),\r\n    i: createStylerProperty(modifierCodes.italic, { createStyler }),\r\n    u: createStylerProperty(modifierCodes.underline, { createStyler }),\r\n    s: createStylerProperty(modifierCodes.strikethrough, { createStyler }),\r\n    d: createStylerProperty(modifierCodes.dim, { createStyler })\r\n})\r\n\r\nexport const modifiersPlugin: StylePlugin = {\r\n    name: 'modifiers',\r\n\r\n    /**\r\n     * Handle property access for modifier functionality and shorthand aliases\r\n     */\r\n    handleProperty(_target: Styler, prop: string, codes: AnsiCodes[], accumulatedText: string, options?: { createStyler?: Function, ansiCodes?: Record<string, AnsiCodes>, pluginRegistry?: any }): Styler | undefined {\r\n        // Handle common modifier properties for better performance\r\n        if (options?.createStyler && options.ansiCodes) {\r\n            // Check if this is a known modifier property\r\n            const modifierCode = propertyCodeMap[prop]\r\n\r\n            // Only for root styler (no codes, no accumulated text) - direct property access\r\n            if (codes.length === 0 && accumulatedText === '' && modifierCode) {\r\n                return (options.createStyler as Function)([modifierCode], '')\r\n            }\r\n\r\n            // Handle special cases with fallback approach\r\n            switch (prop) {\r\n                case 'r':\r\n                case 'reset':\r\n                    // Handle reset with full reset logic\r\n                    const resetCodes = handleReset(codes, modifierCodes.reset)\r\n                    return (options.createStyler as Function)(resetCodes, accumulatedText)\r\n\r\n                case 'b':\r\n                case 'bold':\r\n                    if (modifierCodes.bold) {\r\n                        return (options.createStyler as Function)([...codes, modifierCodes.bold], accumulatedText)\r\n                    }\r\n                    break\r\n\r\n                case 'i':\r\n                case 'italic':\r\n                    if (modifierCodes.italic) {\r\n                        return (options.createStyler as Function)([...codes, modifierCodes.italic], accumulatedText)\r\n                    }\r\n                    break\r\n\r\n                case 'u':\r\n                case 'underline':\r\n                    if (modifierCodes.underline) {\r\n                        return (options.createStyler as Function)([...codes, modifierCodes.underline], accumulatedText)\r\n                    }\r\n                    break\r\n\r\n                case 's':\r\n                case 'strikethrough':\r\n                    if (modifierCodes.strikethrough) {\r\n                        return (options.createStyler as Function)([...codes, modifierCodes.strikethrough], accumulatedText)\r\n                    }\r\n                    break\r\n\r\n                case 'd':\r\n                case 'dim':\r\n                    if (modifierCodes.dim) {\r\n                        return (options.createStyler as Function)([...codes, modifierCodes.dim], accumulatedText)\r\n                    }\r\n                    break\r\n\r\n                default:\r\n                    // Fallback to standard modifier handling if it's a known modifier\r\n                    if (modifierCode) {\r\n                        return (options.createStyler as Function)([...codes, modifierCode], accumulatedText)\r\n                    }\r\n            }\r\n        }\r\n\r\n        // Modifiers are handled through the registered codes\r\n        return undefined\r\n    },\r\n}\r\n\r\n// Self-register the plugin when imported\r\nregister(modifiersPlugin)\r\n\r\n// Augment the Styler interface with modifier properties\r\n// This provides IntelliSense for the modifiers\r\ndeclare module '../styler' {\r\n    interface Styler {\r\n        // Modifiers\r\n        reset: Styler\r\n        bold: Styler\r\n        dim: Styler\r\n        italic: Styler\r\n        underline: Styler\r\n        inverse: Styler\r\n        hidden: Styler\r\n        strikethrough: Styler\r\n\r\n        // Shorthand aliases\r\n        r: Styler\r\n        b: Styler\r\n        i: Styler\r\n        u: Styler\r\n        s: Styler\r\n        d: Styler\r\n    }\r\n}"],"names":[],"mappings":";;AAUA,SAAS,YAAY,OAAoB,WAAmC;AAExE,MAAI,kBAAkB;AACtB,WAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACrC,QAAI,QAAQ,CAAC,EAAE,cAAc;AACzB,wBAAkB;AAClB;AAAA,IACJ;AAAA,EACJ;AAEA,MAAI,CAAC,iBAAiB;AAElB,WAAO,CAAC,GAAG,OAAO,SAAS;AAAA,EAC/B;AAGA,QAAM,oBAAiC,CAAA;AACvC,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACnC,UAAM,OAAO,MAAM,CAAC;AACpB,QAAI,WAAW;AAEf,aAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACrC,YAAM,SAAS,QAAQ,CAAC;AACxB,UAAI,OAAO,gBAAgB,OAAO,aAAa,IAAI,GAAG;AAClD,mBAAW;AACX;AAAA,MACJ;AAAA,IACJ;AACA,QAAI,CAAC,UAAU;AACX,wBAAkB,KAAK,IAAI;AAAA,IAC/B;AAAA,EACJ;AAEA,SAAO,CAAC,GAAG,mBAAmB,SAAS;AAC3C;AAGA,MAAM,gBAAgB;AAAA;AAAA,EAElB,OAAO,EAAE,MAAM,WAAW,OAAO,UAAA;AAAA,EACjC,MAAM,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EAChC,KAAK,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EAC/B,QAAQ,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EAClC,WAAW,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EACrC,SAAS,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EACnC,QAAQ,EAAE,MAAM,WAAW,OAAO,WAAA;AAAA,EAClC,eAAe,EAAE,MAAM,WAAW,OAAO,WAAA;AAC7C;AAGA,cAAc,aAAa;AAG3B,MAAM,kBAAyD;AAAA;AAAA,EAE3D,QAAQ,cAAc;AAAA,EACtB,OAAO,cAAc;AAAA,EACrB,UAAU,cAAc;AAAA,EACxB,aAAa,cAAc;AAAA,EAC3B,WAAW,cAAc;AAAA,EACzB,UAAU,cAAc;AAAA,EACxB,iBAAiB,cAAc;AAAA,EAC/B,SAAS,cAAc;AAAA;AAAA,EAGvB,KAAK,cAAc;AAAA,EACnB,KAAK,cAAc;AAAA,EACnB,KAAK,cAAc;AAAA,EACnB,KAAK,cAAc;AAAA,EACnB,KAAK,cAAc;AAAA,EACnB,KAAK,cAAc;AACvB;AAGA,OAAO,iBAAiB,OAAO,WAAW;AAAA;AAAA,EAEtC,OAAO,qBAAqB,cAAc,OAAO,EAAE,cAAc;AAAA,EACjE,MAAM,qBAAqB,cAAc,MAAM,EAAE,cAAc;AAAA,EAC/D,KAAK,qBAAqB,cAAc,KAAK,EAAE,cAAc;AAAA,EAC7D,QAAQ,qBAAqB,cAAc,QAAQ,EAAE,cAAc;AAAA,EACnE,WAAW,qBAAqB,cAAc,WAAW,EAAE,cAAc;AAAA,EACzE,SAAS,qBAAqB,cAAc,SAAS,EAAE,cAAc;AAAA,EACrE,QAAQ,qBAAqB,cAAc,QAAQ,EAAE,cAAc;AAAA,EACnE,eAAe,qBAAqB,cAAc,eAAe,EAAE,cAAc;AAAA;AAAA,EAGjF,GAAG,qBAAqB,cAAc,OAAO,EAAE,cAAc;AAAA,EAC7D,GAAG,qBAAqB,cAAc,MAAM,EAAE,cAAc;AAAA,EAC5D,GAAG,qBAAqB,cAAc,QAAQ,EAAE,cAAc;AAAA,EAC9D,GAAG,qBAAqB,cAAc,WAAW,EAAE,cAAc;AAAA,EACjE,GAAG,qBAAqB,cAAc,eAAe,EAAE,cAAc;AAAA,EACrE,GAAG,qBAAqB,cAAc,KAAK,EAAE,cAAc;AAC/D,CAAC;AAEM,MAAM,kBAA+B;AAAA,EACxC,MAAM;AAAA;AAAA;AAAA;AAAA,EAKN,eAAe,SAAiB,MAAc,OAAoB,iBAAyB,SAAwH;AAE/M,SAAI,mCAAS,iBAAgB,QAAQ,WAAW;AAE5C,YAAM,eAAe,gBAAgB,IAAI;AAGzC,UAAI,MAAM,WAAW,KAAK,oBAAoB,MAAM,cAAc;AAC9D,eAAQ,QAAQ,aAA0B,CAAC,YAAY,GAAG,EAAE;AAAA,MAChE;AAGA,cAAQ,MAAA;AAAA,QACJ,KAAK;AAAA,QACL,KAAK;AAED,gBAAM,aAAa,YAAY,OAAO,cAAc,KAAK;AACzD,iBAAQ,QAAQ,aAA0B,YAAY,eAAe;AAAA,QAEzE,KAAK;AAAA,QACL,KAAK;AACD,cAAI,cAAc,MAAM;AACpB,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,IAAI,GAAG,eAAe;AAAA,UAC7F;AACA;AAAA,QAEJ,KAAK;AAAA,QACL,KAAK;AACD,cAAI,cAAc,QAAQ;AACtB,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,MAAM,GAAG,eAAe;AAAA,UAC/F;AACA;AAAA,QAEJ,KAAK;AAAA,QACL,KAAK;AACD,cAAI,cAAc,WAAW;AACzB,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,SAAS,GAAG,eAAe;AAAA,UAClG;AACA;AAAA,QAEJ,KAAK;AAAA,QACL,KAAK;AACD,cAAI,cAAc,eAAe;AAC7B,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,aAAa,GAAG,eAAe;AAAA,UACtG;AACA;AAAA,QAEJ,KAAK;AAAA,QACL,KAAK;AACD,cAAI,cAAc,KAAK;AACnB,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,GAAG,GAAG,eAAe;AAAA,UAC5F;AACA;AAAA,QAEJ;AAEI,cAAI,cAAc;AACd,mBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,YAAY,GAAG,eAAe;AAAA,UACvF;AAAA,MAAA;AAAA,IAEZ;AAGA,WAAO;AAAA,EACX;AACJ;AAGA,SAAS,eAAe;"}