{"version":3,"file":"space.cjs","sources":["../../src/plugins/space.ts"],"sourcesContent":["/**\r\n * Space mode plugin\r\n * Adds automatic spacing between chained segments\r\n */\r\nimport type { StylePlugin } from './base'\r\nimport type { AnsiCodes } from '../ansi'\r\nimport { Styler } from '../styler'\r\nimport { register } from '../registry'\r\n\r\n// Space mode marker\r\nconst SPACE_MARKER = '\\x00AS\\x00'\r\n\r\nexport const spacePlugin: StylePlugin = {\r\n  name: 'space',\r\n\r\n  handleProperty(_target: Styler, prop: string, codes: AnsiCodes[], accumulatedText: string, options?: { createStyler?: Function, ansiCodes?: Record<string, AnsiCodes>, pluginRegistry?: any }) {\r\n    // Handle space (.as) - creates a persistent mode that adds spaces until reset\r\n    if (prop === 'as') {\r\n      // Use the passed createStyler function to avoid circular dependencies\r\n      if (options?.createStyler) {\r\n        // Create a special ANSI code for space mode\r\n        const spaceCode = { open: SPACE_MARKER, close: '' }\r\n        return (options.createStyler as Function)([...codes, spaceCode], accumulatedText)\r\n      }\r\n    }\r\n\r\n    return undefined\r\n  },\r\n\r\n  isMarkerCode(code: AnsiCodes) {\r\n    // Identify our space marker code\r\n    return code.open === SPACE_MARKER\r\n  },\r\n\r\n  processText(codes: AnsiCodes[], text: string, accumulatedText: string, filterMarkerCodes: (codes: AnsiCodes[]) => AnsiCodes[]) {\r\n    // Check if we're in auto-space mode\r\n    const autoSpaceMode = codes.some(code => code.open === SPACE_MARKER)\r\n\r\n    if (autoSpaceMode) {\r\n      let styledText = ''\r\n\r\n      // Add a plain space before the text if accumulatedText is not empty\r\n      if (accumulatedText.length > 0 && !accumulatedText.endsWith(' ')) {\r\n        // Apply styles to the space with no styling codes\r\n        const plainSpace = applyStyle(' ', [])\r\n        // Apply styles to the actual text with the normal codes (excluding markers)\r\n        const styledTextContent = applyStyle(text, filterMarkerCodes(codes))\r\n        styledText = plainSpace + styledTextContent\r\n      } else {\r\n        // Apply styles to the text with the normal codes (excluding markers)\r\n        styledText = applyStyle(text, filterMarkerCodes(codes))\r\n      }\r\n\r\n      return { styledText }\r\n    }\r\n\r\n    return undefined\r\n  }\r\n}\r\n\r\n// Self-register the plugin when imported\r\nregister(spacePlugin)\r\n\r\n// Export helper to check if codes contain space mode\r\nexport function isSpaceMode(codes: AnsiCodes[]): boolean {\r\n  return codes.some(code => code.open === SPACE_MARKER)\r\n}\r\n\r\n// Helper to apply ANSI codes to text\r\nfunction applyStyle(text: string, codes: AnsiCodes[]): string {\r\n  if (codes.length === 0) {\r\n    return text\r\n  }\r\n\r\n  const openCodes = codes.map((c) => c.open).join('')\r\n  const closeCodes = codes\r\n    .map((c) => c.close)\r\n    .reverse()\r\n    .join('')\r\n\r\n  return `${openCodes}${text}${closeCodes}`\r\n}\r\n\r\n// Augment the Styler interface with space property\r\ndeclare module '../styler' {\r\n  interface Styler {\r\n    // Space method\r\n    as: Styler\r\n  }\r\n}"],"names":["register"],"mappings":";;;AAUA,MAAM,eAAe;AAEd,MAAM,cAA2B;AAAA,EACtC,MAAM;AAAA,EAEN,eAAe,SAAiB,MAAc,OAAoB,iBAAyB,SAAoG;AAE7L,QAAI,SAAS,MAAM;AAEjB,UAAI,mCAAS,cAAc;AAEzB,cAAM,YAAY,EAAE,MAAM,cAAc,OAAO,GAAA;AAC/C,eAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,SAAS,GAAG,eAAe;AAAA,MAClF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,MAAiB;AAE5B,WAAO,KAAK,SAAS;AAAA,EACvB;AAAA,EAEA,YAAY,OAAoB,MAAc,iBAAyB,mBAAwD;AAE7H,UAAM,gBAAgB,MAAM,KAAK,CAAA,SAAQ,KAAK,SAAS,YAAY;AAEnE,QAAI,eAAe;AACjB,UAAI,aAAa;AAGjB,UAAI,gBAAgB,SAAS,KAAK,CAAC,gBAAgB,SAAS,GAAG,GAAG;AAEhE,cAAM,aAAa,WAAW,KAAK,EAAE;AAErC,cAAM,oBAAoB,WAAW,MAAM,kBAAkB,KAAK,CAAC;AACnE,qBAAa,aAAa;AAAA,MAC5B,OAAO;AAEL,qBAAa,WAAW,MAAM,kBAAkB,KAAK,CAAC;AAAA,MACxD;AAEA,aAAO,EAAE,WAAA;AAAA,IACX;AAEA,WAAO;AAAA,EACT;AACF;AAGAA,SAAAA,SAAS,WAAW;AAGb,SAAS,YAAY,OAA6B;AACvD,SAAO,MAAM,KAAK,CAAA,SAAQ,KAAK,SAAS,YAAY;AACtD;AAGA,SAAS,WAAW,MAAc,OAA4B;AAC5D,MAAI,MAAM,WAAW,GAAG;AACtB,WAAO;AAAA,EACT;AAEA,QAAM,YAAY,MAAM,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE;AAClD,QAAM,aAAa,MAChB,IAAI,CAAC,MAAM,EAAE,KAAK,EAClB,UACA,KAAK,EAAE;AAEV,SAAO,GAAG,SAAS,GAAG,IAAI,GAAG,UAAU;AACzC;;;"}