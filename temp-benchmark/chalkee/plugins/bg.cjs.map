{"version":3,"file":"bg.cjs","sources":["../../src/plugins/bg.ts"],"sourcesContent":["import type { StylePlugin } from './base'\r\nimport { Styler } from '../styler'\r\nimport type { AnsiCodes } from '../ansi'\r\nimport { registeredCodes, register } from '../registry'\r\n// Removed direct import of coreColorsPlugin to avoid circular dependencies\r\n\r\n// Background mode marker\r\nconst BG_MODE_MARKER = '\\x00BG\\x00'\r\n\r\n// Define background color properties directly on the Styler prototype\r\nObject.defineProperties(Styler.prototype, {\r\n  // bg namespace for dynamic background colors\r\n  bg: {\r\n    get() {\r\n      // Create a special marker for background-color mode\r\n      const bgModeCode = { open: BG_MODE_MARKER, close: '' }\r\n      return new Styler([bgModeCode], '')\r\n    },\r\n    enumerable: true,\r\n    configurable: true\r\n  }\r\n})\r\n\r\nexport const bgPlugin: StylePlugin = {\r\n  name: 'bg',\r\n\r\n  handleProperty(_target: Styler, prop: string, codes: AnsiCodes[], accumulatedText: string, options?: { createStyler?: Function, ansiCodes?: Record<string, AnsiCodes> }) {\r\n    // Handle bg namespace - creates a persistent background-color mode\r\n    if (prop === 'bg') {\r\n      // Use the passed createStyler function to avoid circular dependencies\r\n      if (options?.createStyler) {\r\n        // Create a special marker for background-color mode\r\n        const bgModeCode = { open: BG_MODE_MARKER, close: '' }\r\n        return (options.createStyler as Function)([...codes, bgModeCode], accumulatedText)\r\n      }\r\n    }\r\n\r\n    // Check if we're in background-color mode\r\n    const bgMode = codes.some(code => code.open === BG_MODE_MARKER)\r\n\r\n    // Get core ANSI codes from the registry instead of directly importing coreColorsPlugin\r\n    const coreAnsiCodes = registeredCodes\r\n\r\n    // If in bg-mode and accessing a foreground color, convert to background color\r\n    if (bgMode && options?.ansiCodes && prop in options.ansiCodes && !prop.startsWith('bg')) {\r\n      // Check if it's a foreground color (not a modifier like bold, italic, etc.)\r\n      const isForegroundColor = [\r\n        'black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white', 'gray', 'grey',\r\n        'blackBright', 'redBright', 'greenBright', 'yellowBright', 'blueBright', 'magentaBright', 'cyanBright', 'whiteBright'\r\n      ].includes(prop)\r\n\r\n      if (isForegroundColor) {\r\n        // Convert to background color: red -> bgRed, redBright -> bgRedBright\r\n        const bgStyleName = ('bg' + prop.charAt(0).toUpperCase() + prop.slice(1)) as keyof typeof coreAnsiCodes\r\n        if (bgStyleName in coreAnsiCodes && options.createStyler) {\r\n          return (options.createStyler as Function)([...codes, coreAnsiCodes[bgStyleName]], accumulatedText)\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined\r\n  },\r\n\r\n  isMarkerCode(code: AnsiCodes) {\r\n    // Identify our bg-mode marker code\r\n    return code.open === BG_MODE_MARKER\r\n  },\r\n\r\n}\r\n\r\n// Self-register the plugin when imported\r\nregister(bgPlugin)\r\n\r\n// Add BG_MODE_CODE_MARKER as a property of the plugin so other plugins can access it\r\nObject.assign(bgPlugin, { BG_MODE_CODE_MARKER: BG_MODE_MARKER })\r\n\r\n// Augment the Styler interface with bg mode property\r\ndeclare module '../styler' {\r\n  interface Styler {\r\n    // Nested namespace for background colors\r\n    bg: {\r\n      black: Styler\r\n      red: Styler\r\n      green: Styler\r\n      yellow: Styler\r\n      blue: Styler\r\n      magenta: Styler\r\n      cyan: Styler\r\n      white: Styler\r\n      blackBright: Styler\r\n      redBright: Styler\r\n      greenBright: Styler\r\n      yellowBright: Styler\r\n      blueBright: Styler\r\n      magentaBright: Styler\r\n      cyanBright: Styler\r\n      whiteBright: Styler\r\n    }\r\n  }\r\n}"],"names":["Styler","registeredCodes","register"],"mappings":";;;;AAOA,MAAM,iBAAiB;AAGvB,OAAO,iBAAiBA,OAAAA,OAAO,WAAW;AAAA;AAAA,EAExC,IAAI;AAAA,IACF,MAAM;AAEJ,YAAM,aAAa,EAAE,MAAM,gBAAgB,OAAO,GAAA;AAClD,aAAO,IAAIA,OAAAA,OAAO,CAAC,UAAU,GAAG,EAAE;AAAA,IACpC;AAAA,IACA,YAAY;AAAA,IACZ,cAAc;AAAA,EAAA;AAElB,CAAC;AAEM,MAAM,WAAwB;AAAA,EACnC,MAAM;AAAA,EAEN,eAAe,SAAiB,MAAc,OAAoB,iBAAyB,SAA8E;AAEvK,QAAI,SAAS,MAAM;AAEjB,UAAI,mCAAS,cAAc;AAEzB,cAAM,aAAa,EAAE,MAAM,gBAAgB,OAAO,GAAA;AAClD,eAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,UAAU,GAAG,eAAe;AAAA,MACnF;AAAA,IACF;AAGA,UAAM,SAAS,MAAM,KAAK,CAAA,SAAQ,KAAK,SAAS,cAAc;AAG9D,UAAM,gBAAgBC,SAAAA;AAGtB,QAAI,WAAU,mCAAS,cAAa,QAAQ,QAAQ,aAAa,CAAC,KAAK,WAAW,IAAI,GAAG;AAEvF,YAAM,oBAAoB;AAAA,QACxB;AAAA,QAAS;AAAA,QAAO;AAAA,QAAS;AAAA,QAAU;AAAA,QAAQ;AAAA,QAAW;AAAA,QAAQ;AAAA,QAAS;AAAA,QAAQ;AAAA,QAC/E;AAAA,QAAe;AAAA,QAAa;AAAA,QAAe;AAAA,QAAgB;AAAA,QAAc;AAAA,QAAiB;AAAA,QAAc;AAAA,MAAA,EACxG,SAAS,IAAI;AAEf,UAAI,mBAAmB;AAErB,cAAM,cAAe,OAAO,KAAK,OAAO,CAAC,EAAE,gBAAgB,KAAK,MAAM,CAAC;AACvE,YAAI,eAAe,iBAAiB,QAAQ,cAAc;AACxD,iBAAQ,QAAQ,aAA0B,CAAC,GAAG,OAAO,cAAc,WAAW,CAAC,GAAG,eAAe;AAAA,QACnG;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,MAAiB;AAE5B,WAAO,KAAK,SAAS;AAAA,EACvB;AAEF;AAGAC,SAAAA,SAAS,QAAQ;AAGjB,OAAO,OAAO,UAAU,EAAE,qBAAqB,gBAAgB;;"}